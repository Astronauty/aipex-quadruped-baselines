# /convex_mpc_controller:
#   ros__parameters:
#     N_MPC: 5
#     Q_scale: 25.0
#     mpc_dt: 0.02
#     mass: 15.7
#     JOINT_TORQUE_PUBLISH_RATE_MS: 15
#     MPC_STATE_UPDATE_RATE_MS: 15
#     mu_static_friction: 10.0
#     footstep_planning_horizon_s: 0.01
#     Q_diag: [0.0, 50.0, 0.0, 100.0, 0.0, 80.0, 2.0, 5.0, 0.0, 10.0, 0.0, 3.0, 0.0]
#     qos_overrides:
#       /parameter_events:
#         publisher:
#           depth: 1000
#           durability: volatile
#           history: keep_last
#           reliability: reliable
#     use_sim_time: false


# N_MPC 5 roll pitch unstable
# /convex_mpc_controller:
#   ros__parameters:
#     N_MPC: 10
#     Q_scale: 50.0
#     mpc_dt: 0.025
#     mass: 15.7
#     JOINT_TORQUE_PUBLISH_RATE_MS: 2
#     MPC_STATE_UPDATE_RATE_MS: 25
#     mu_static_friction: 0.25
#     footstep_planning_horizon_s: 0.1
#     # Q_diag: [1.0, 0.0, 1.0, 0.0, 1.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0]
#     Q_diag: [0.0, 5.0, 0.0, 50.0, 0.0, 100.0, 0.0, 0.0, 0.0, 5.0, 0.0, 5.0, 0.0]
#     qos_overrides:
#       /parameter_events:
#         publisher:
#           depth: 1000
#           durability: volatile
#           history: keep_last
#           reliability: reliable
#     use_sim_time: false


/convex_mpc_controller:
  ros__parameters:
    N_MPC: 10 # Number of timesteps for mpc horizon
    mpc_dt: 0.025 # Discretization timestep for MPC
    mass: 15.7 # Mass in kg of quadruped
    JOINT_TORQUE_PUBLISH_RATE_MS: 2 # Rate in ms to publish joint torques, reusing previous MPC solutions.
    MPC_STATE_UPDATE_RATE_MS: 25
    mu_static_friction: 0.25
    footstep_planning_horizon_s: 0.1
    # Q_diag: [0.0, 0.0, 0.0, 0.0, 0.0, 100.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0]
    # State vector: [roll, roll_dot, pitch, pitch_dot, yaw, yaw_dot, x, x_dot, y, y_dot, z, z_dot, gravity]
    # Tuned - front legs lifted due to large pitch (-0.504 rad): increase pitch control to level the robot
    # Increasing pitch weight and pitch_dot damping to correct the pitch angle and bring front legs down
    Q_diag: [13.0, 22.0, 15.0, 16.0, 1.0, 100.0, 2.0, 1.5, 2.0, 1.5, 4.0, 10.0, 0.0]
    Q_scale: 5.0 # Weighting factor where Q = Q_scale * diag(Q_diag) - moderate for stability
    Q_n_scale: 12.0 # Weighting factor Q_N for final state in horizon - kept same
    min_vertical_grf: 23.0 # Minimum vertical GRF - kept moderate to allow proper contact
    qos_overrides:
      /parameter_events:
        publisher:
          depth: 1000
          durability: volatile
          history: keep_last
          reliability: reliable
    use_sim_time: false

